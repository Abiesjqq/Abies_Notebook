机器视觉：利用传感器（摄像头，激光雷达） + 算法（图像处理，深度学习）  
核心功能：识别，定位，跟踪，理解

## 基本概念

数字图像性质：

- 光度值（亮度或彩色），有不同颜色空间
- 位置按规则方式排列
- 坐标值隐含

数字图像的矩阵表示：$N\times M$的图像用$3\times N\times M$的矩阵表示（3 表示 RGB）

**空间分辨率**：数字图像中可分辨的细节程度，通常用单位长度内的像素数量（如每英寸像素数 PPI）来衡量，数值越高，图像越清晰细腻。

**灰度级分辨率**：数字图像中每个像素点能够表示的亮度层次多少，级数越高，图像的明暗过渡越平滑自然。

## 几何变换和灰度变换

仿射变化：经过旋转、平移、错切等变换后，相邻像素本身的性质不变

旋转：左乘旋转矩阵

灰度变换是指根据某种目标条件按一定变换关系逐点改变原图像中每一个选告诉灰度值的方法。  
设原灰度值$D=f(x,y) $，处理后灰度值为$D'=g(x,y) $，则灰度增强表示为：

$$g(x,y)=T[f(x,y)]\quad \text{or}\quad D'=T(D)$$

### 二值化算法——非零元素取一法 

（传统方法）

对于灰度图像 f，若某像素灰度值为 0，则不变；若不为 0，则全部变为 255  
阈值 T 可自行设置

### 灰度线性变换

将图像中所有的点的灰度按照线性灰度变换函数进行变换  
令原灰度范围为$[z_1,z_2] $,线性变换后为$[z_1',z_2'] $，则

$$ g(x,y)=z_1'+\frac{z_2'-z_1'}{z_2-z_1}(f(x,y)-z_1)$$

### 窗口灰度变换

限定窗口为$[L,U] $，函数为：

$$
f(x)=
\begin{cases}
0, x<L \\
x,L\le x\le U \\
255, x>U
\end{cases}
$$

分段灰度变换同理。

### 灰度直方图

横坐标是灰度，用 r 表示；纵坐标是灰度值像素的个数，用 H 表示（也可以用图像灰度概率密度函数$P_r(r) $表示，它等于具有 r 灰度级的像素个数与图像总像素个数的比例）  
根据灰度直方图设置阈值

## 图像平滑处理和边缘检测

消除图像噪声的工作称之为图像平滑或滤波。  
平滑的目的：改善图像质量和抽出对象特征。

常见的平滑滤波算法有：线性平滑、非线性平滑、自适应平滑

- 线性平滑：对每一个像素点的灰度值用它的邻域值来代替，其邻域大小为：$N\times N$ , $N$ 一般取奇数
- 非线性平滑：不对所有像素都用它的邻域平均值来代替，而是取一个阈值，当像素灰度值与其邻域平均值之间的差值大于已知值时才以均值代替；当像素灰度值与其邻域平均值之间的差值不大于阈值时取其本身的灰度值
- 自适应平滑：自适应平滑法是以尽量不模糊边缘轮廓为目标

### 二值图像黑白点噪声滤波

消去二值图像$f(i,j) $ 上的黑彩的噪声，当像$f(i,j) $ 周围的 8 个像素的平均值为 a 时，若$ |f(i,j)-a| $ 的值在阈值（127.5）以上，则对$f(i,j) $ 的黑白进行翻转；否则不变。

对图像像素的处理方式上可以划分为点处理和区域处理。

- 点处理：输出像素值仅取决于输入像素值的图像处理方法
- 区域处理（卷积核）：输出像素值与输入像素在一定的范围内的相邻像素值有关

### 领域平均法

1. $3 \times 3$ 均值滤波：用当前像素及其周围 $3 \times 3$ 邻域内所有像素的平均值替代当前像素，实现平滑降噪。
2. 超限邻域平均法：只有当邻域内某些像素与中心像素差异超过设定阈值时，才将这些像素替换为邻域平均值，从而减少异常值影响。
3. $N \times N$均值滤波器：与 $3 \times 3$ 均值滤波类似，但窗口大小可扩展为任意 $N \times N$，通过邻域平均实现更强平滑。
4. 选择式掩模平滑：通过设定规则（如与中心像素的灰度差阈值）来筛选邻域像素，仅对符合条件的像素进行加权或平均，从而在去除噪声的同时尽可能保留图像边缘与细节。

### 中值滤波

- $N \times N$中值滤波：窗口内各点的中值
- 十字型中值滤波：十字型屏蔽窗口
- $N \times N$最大值滤波：窗口内各点的最大值

### Roberts 边缘检测

Roberts 算子又称为交叉微分算法，基于交叉差分的梯度算法，通过局部差分计算检测边缘线条。  
Roberts 算子的模板分为水平方向 $dx$ 和垂直方向 $dy$ ，像素点处 x 和 y 方向上的梯度 $Gx$ 、 $Gy$ 为：

$$
dx=\begin{bmatrix}
-1 & 0 \\
0 & 1
\end{bmatrix},\quad
dy=\begin{bmatrix}
0 & -1 \\
1 & 0
\end{bmatrix}
$$

$$G_x=\frac{\partial f}{\partial x},\quad G_y=\frac{\partial f}{\partial y}$$

### Prewitt 边缘检测算子

Prewitt 算子采用 $3 \times 3$ 模板对区域内的像素值进行计算，而 Robert 算子的模板为 $2 \times 2$，
故 Prewitt 算子的边缘检测结果在水平方向和垂直方向均比 Robert 算子更加明显。

$$
dx=\begin{bmatrix}
-1 & 0 & 1 \\
-1 & 0 & 1 \\
-1 & 0 & 1
\end{bmatrix},\quad
dy=\begin{bmatrix}
-1 & -1 & -1 \\
0 & 0 & 0 \\
1 & 1 & 1
\end{bmatrix}
$$

### Sobel 边缘检测算子

Sobel 算子在 Prewitt 算子的基础上增加了权重的概念，认为相邻点的距离远近对当前像素点的影响是不同的，
距离越近的像素点对应当前像素的影响越大，从而实现图像锐化并突出边缘轮廓。

### 拉普拉斯(Laplacian)算子

拉普拉斯（ Laplacian ）算子是 n 维欧几里德空间中的一个二阶微分算子，常用于图像增强领域和边缘提取。
采用灰度差分，计算邻域内的像素。中心减去领域平均。

## 特征提取与匹配

关键点提取 K 个（远小于像素数 N），每个关键点的特征用 K 维向量表示  
用$K\times K $的矩阵表示图像特征  
对环境变化、遮挡和少量位姿变化的鲁棒性增强

### Harris 角点响应（Harris Corner Response）

表示图像中某个像素位置是角点、边缘还是平坦区域的“响应值”（response value），由**图像梯度的二阶矩阵（结构张量）**决定  
当窗口沿任意方向移动时，图像强度变化都较大，则为角点。

对每个像素，计算梯度：

$$
I_u = \frac{\partial I}{\partial u}, \quad
I_v = \frac{\partial I}{\partial v}
$$

构造二阶矩阵（结构张量）：

$$
M =
\begin{bmatrix}
\sum w\,I_u^2 & \sum w\,I_u I_v \\
\sum w\,I_u I_v & \sum w\,I_v^2
\end{bmatrix}
$$

其中 $w$ 是窗口函数（通常是高斯加权）。

Harris 响应函数：

$$
R = \det(M) - k\,(\operatorname{trace}(M))^2
$$

- $\det(M) = \lambda_1 \lambda_2$
- $\operatorname{trace}(M) = \lambda_1 + \lambda_2$
- $k$ 为经验参数（通常 $k = 0.04 \sim 0.06$）

解释响应值 R：

- R > 0 且较大 → 角点（两个方向梯度都大）
- R < 0 → 边缘（一个方向梯度大，另一个小）
- R ≈ 0 → 平坦区域（无显著梯度）

### SIFT 算子

局部特征描述子，用于图像匹配、目标识别和三维重建。  
对尺度、旋转不变，对光照和少量仿射变换具有鲁棒性。

1. 关键点检测：在图像的不同缩放层（高斯金字塔）中，找到局部最亮或最暗的点，这些点通常是角点或纹理丰富的位置，容易被识别。
2. 关键点精确定位：对找到的点进一步微调位置，去掉对比度太低或位于边缘的点，保证稳定可靠。
3. 方向分配：看关键点周围的梯度方向，把最显著的方向设为主方向，样即使图像旋转，描述子也能保持一致。
4. 描述子生成：取关键点周围一块小区域，划分成 $4\times4$ 个小格子，每个小格子统计梯度方向分布（8 个方向）。把所有格子的统计结果连起来，得到 128 维向量。向量归一化，提高对光照变化的鲁棒性。

### 重复纹理？

采用相对度量方案 Ratio ，并结合阈值，通常取 0.7-0.9  
最接近的描述子，要比第二接近的描述子接近很多，解决重复纹理带来的问题

$$x'=argmin\frac{||F(x)-F(x')||}{||F(x)-F(x'')||}$$

### 剔除错误匹配

所有正确的特征匹配应当符合本质矩阵的关系

离群点不符合本质矩阵关系，但不知道本质矩阵

用8对匹配关系求解本质矩阵 E ，再将其他的匹配代入，检查方差是否满足